-- In this SQL code, I'm querying a database that's holding data on a DVD Rental Shop to answer questions about the data -- 

-- Final Project -- 

-- Part 1 --

SELECT 
    staff.first_name,
    staff.last_name,
    address.address,
    address.district,
    city.city,
    country.country 
FROM
    staff
    INNER JOIN address
        ON staff.address_id = address.address_id
    INNER JOIN city
	ON address.city_id = city.city_id
    INNER JOIN country
	ON city.country_id = country.country_id;

-- Part 2 --

SELECT
    inventory.inventory_id,
    inventory.store_id,
    film.title,
    film.rating,
    film.rental_rate,
    film.replacement_cost
FROM
    inventory
    INNER JOIN film
	ON inventory.film_id = film.film_id;
        
-- Part 3 --

SELECT
    inventory.store_id,
    film.rating,
    COUNT(inventory.inventory_id) AS number_of_items_in_inventory
FROM
    inventory
    INNER JOIN film
	ON inventory.film_id = film.film_id 
GROUP BY 
    film.rating,
    inventory.store_id;
    
-- Part 4 --

SELECT
    category.name,
    inventory.store_id,
    COUNT(film.film_id) AS number_of_films_in_this_group,
    AVG(film.replacement_cost) AS average_replacement_cost,
    SUM(film.replacement_cost) AS total_cost_to_replace
FROM
    category
    INNER JOIN film_category
	ON category.category_id = film_category.category_id
    INNER JOIN inventory
	ON film_category.film_id = inventory.film_id
    INNER JOIN film
	ON inventory.film_id = film.film_id
GROUP BY 
    inventory.store_id,
    category.name;
    
    -- Part 5 --
    
SELECT
    customer.first_name,
    customer.last_name,
    customer.store_id,
    customer.active,
    address.address,
    address.district,
    city.city,
    country.country
FROM
    customer
    INNER JOIN address
        ON customer.address_id = address.address_id
    INNER JOIN city
	ON address.city_id = city.city_id
    INNER JOIN country
	ON city.country_id = country.country_id;
	
    -- Part 6 --
    
SELECT
    customer.first_name,
    customer.last_name,
    COUNT(rental.customer_id) AS total_lifetime_rentals,
    SUM(payment.amount) AS total_of_all_payments
FROM
    customer
    LEFT JOIN rental
	ON customer.customer_id = rental.customer_id
    LEFT JOIN payment
	ON rental.rental_id = payment.rental_id
GROUP BY rental.customer_id
ORDER BY
    total_of_all_payments DESC;
    
    -- Part 7 --
    
SELECT
    'advisor' AS type,
    first_name,
    last_name,
    'maven analytics' AS company_name
FROM advisor

UNION

SELECT
    'investor' AS type,
    first_name,
    last_name,
    company_name
FROM investor;

-- Part 8 --

SELECT
    CASE 
	WHEN actor_award.awards = 'Emmy, Oscar, Tony ' THEN '3 awards'
        WHEN actor_award.awards IN ('Emmy, Oscar','Emmy, Tony', 'Oscar, Tony') THEN '2 awards'
	ELSE '1 award'
    END AS number_of_awards, 
    AVG(CASE WHEN actor_award.actor_id IS NULL THEN 0 ELSE 1 END) AS pct_w_one_film
	
FROM 
    actor_award
	
GROUP BY 
    CASE 
	WHEN actor_award.awards = 'Emmy, Oscar, Tony ' THEN '3 awards'
        WHEN actor_award.awards IN ('Emmy, Oscar','Emmy, Tony', 'Oscar, Tony') THEN '2 awards'
	ELSE '1 award'
    END;
